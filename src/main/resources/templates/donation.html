<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" class="h-full bg-gray-100">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Make a Donation</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="h-full">
    <div
      class="min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8"
    >
      <div class="max-w-md w-full space-y-8">
        <div>
          <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
            Make a Donation
          </h2>
        </div>
        <form id="donation-form" class="mt-8 space-y-6">
          <div class="rounded-md shadow-sm -space-y-px">
            <div>
              <label for="campaign" class="sr-only">Select Campaign</label>
              <select
                id="campaign"
                name="campaign_id"
                required
                class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
              >
                <option value="">Select a campaign</option>
              </select>
            </div>
            <div>
              <label for="student" class="sr-only"
                >Select Student (Optional)</label
              >
              <select
                id="student"
                name="student_id"
                class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
              >
                <option value="">Select a student (optional)</option>
              </select>
            </div>
            <div>
              <label for="amount" class="sr-only">Donation Amount ($)</label>
              <input
                id="amount"
                name="amount"
                type="number"
                required
                class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm"
                placeholder="Donation Amount ($)"
              />
            </div>
          </div>

          <div>
            <button
              type="submit"
              class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
            >
              Donate
            </button>
          </div>
        </form>
        <div
          id="result-message"
          class="mt-4 text-center text-sm text-gray-600"
        ></div>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        $.ajax({
          url: "/api/v1/campaigns",
          type: "GET",
          success: function (data) {
            $.each(data, function (index, campaign) {
              $("#campaign").append(
                '<option value="' +
                  campaign.id +
                  '">' +
                  campaign.name +
                  "</option>"
              );
            });
          },
          error: function () {
            $("#result-message")
              .text("Failed to load campaigns")
              .addClass("text-red-600");
          },
        });

        $.ajax({
          url: "/api/v1/student",
          type: "GET",
          success: function (data) {
            $.each(data, function (index, student) {
              $("#student").append(
                '<option value="' +
                  student.id +
                  '">' +
                  student.name +
                  "</option>"
              );
            });
          },
          error: function () {
            $("#result-message")
              .text("Failed to load students")
              .addClass("text-red-600");
          },
        });
      });

      $("#donation-form").submit(function (event) {
        event.preventDefault();

        var donorId = 1; // Assuming donorId is 1, modify this as per your application logic
        var formData = {
          donorId: donorId,
          campaignId: $("#campaign").val(),
          studentId: $("#student").val() || null,
          amount: $("#amount").val(),
        };

        $.ajax({
          url: "/api/donations",
          type: "POST",
          contentType: "application/json",
          data: JSON.stringify(formData),
          success: function (response) {
            $("#result-message").html(
              '<p class="text-green-600">Donation successful!</p>'
            );
          },
          error: function (xhr, status, error) {
            $("#result-message").html(
              '<p class="text-red-600">Failed to make donation: ' +
                xhr.responseText +
                "</p>"
            );
          },
        });
      });
    </script>
  </body>
</html>
